#!/bin/bash

echo "Generate python3 protobuf files."
python3 -m grpc_tools.protoc -I./openmodelica_python_gym/grpc/ --python_out=./openmodelica_python_gym/grpc/ --grpc_python_out=./openmodelica_python_gym/grpc/ ./openmodelica_python_gym/grpc/python_gym.proto || exit 1

echo "Generate cpp protobuf files."
protoc -I ./openmodelica_python_gym/grpc/  --grpc_out=./openmodelica_python_gym/external_lib/grpc_interface/generated --plugin=protoc-gen-grpc=`which grpc_cpp_plugin` ./openmodelica_python_gym/grpc/python_gym.proto || exit 1
protoc -I ./openmodelica_python_gym/grpc/   --cpp_out=./openmodelica_python_gym/external_lib/grpc_interface/generated  ./openmodelica_python_gym/grpc/python_gym.proto || exit 1

echo "Fix python autogenerated files."
sed -i "s/import python_gym_pb2 as python__gym__pb2/from openmodelica_python_gym.grpc import python_gym_pb2 as python__gym__pb2/" ./openmodelica_python_gym/grpc/python_gym_pb2_grpc.py 
